"use strict";var main=function(){this.load=function(e){var t=e.domNode.querySelector("#speed #unit select"),n=e.domNode.querySelector("#details-main");app.IS_APP_STARTING&&(utils.setTransition(n,"bottom-current"),app.IS_APP_STARTING=!1),document.body.style.background="#f4f4f4",app.units.setNode(t),this.setEvs(e.domNode),this.setDataReceiver(e),this.updateUnitSelector(e.domNode)},this.setEvs=function(e){var t=e.querySelector('section[role="region"] header > button'),n=e.querySelector('section[role="region"] #drawer-lock'),i=e.querySelector('section[role="region"] header menu #about'),r=e.querySelector('section[role="region"] .footer #btn-more'),a=e.querySelector('[role="drawer"] [data-type="list"] #donate'),o=e.querySelector('[role="drawer"] [role="toolbar"] #prefs'),s=e.querySelector("#speed #unit select");t.addEventListener("click",function(){e.querySelector('section[role="region"]').classList.toggle("draweropen")}),n.addEventListener("click",function(){e.querySelector('section[role="region"]').classList.remove("draweropen")}),a.addEventListener("click",function(){am.startActivity(am.catalog.get("extras","donate"),{animation:["bottom-current"]}).then(function(){app.gauge.hide(!0)})}),o.addEventListener("click",function(){am.startActivity(am.catalog.get("preferences","p_main"),{animation:["right-current","current-left"]}).then(function(){app.gauge.hide(!0)})}),i.addEventListener("click",function(){am.startActivity(am.catalog.get("views","about"),{animation:["right-current","current-left"]}).then(function(){app.gauge.hide(!0)})}),r.addEventListener("click",function(){am.startActivity(am.catalog.get("views","moreInfo"),{animation:["right-current","current-left"]}).then(function(){app.gauge.hide(!0)})}),s.addEventListener("change",function(){app.units.setSelUni(this.value)})},this.setDataReceiver=function(e){var t=this,n=e.domNode;am.events.suscribe(e,"newdata"),n.addEventListener("newdata",function(e){return t.setNodeData(e,n)}),am.events.suscribe(e,"newspeed"),n.addEventListener("newspeed",this.updateSpeed),am.events.suscribe(e,"unitchanged"),n.addEventListener("unitchanged",function(){return t.updateUnitSelector(n)})},this.setNodeData=function(e,t){var n=t.querySelector("#data #latitude .value"),i=t.querySelector("#data #longitude .value"),r=t.querySelector("#data #altitude .value"),a=t.querySelector(".footer #details #accuracy .value"),o=t.querySelector(".footer #details #power .value"),s=t.querySelector(".footer #lastReceived"),c=e.detail.coords,u=Math.round(c.accuracy);a.innerHTML=u+" m",r.innerHTML=Math.round(c.altitude||0)+" Mts",this.updateLatLong(n,i,c),this.setTimeReceiver(s,e.detail.timestamp),this.updatePowerNode(o,u)},this.updateLatLong=function(e,t,n){var i=new GeoPoint(n.latitude,n.longitude);e.innerHTML=i.getLonDeg(),t.innerHTML=i.getLatDeg()},this.updateSpeed=function(e){var t=this.querySelector("#speed #speedValue"),n=this.querySelector("#speed #unit p"),i=parseInt(t.innerHTML),r=e.detail.finalValue,a=setInterval(function(){r!=i?i<r?t.innerHTML=i+=1:(t.innerHTML=i-=1,t.innerHTML.length<3?(t.style.fontSize=null,n.style.display="block"):3==t.innerHTML.length?(t.style.fontSize="3.2rem",n.style.display="block"):(t.style.fontSize="3.2rem",n.style.display="none")):clearInterval(a)},20)},this.updatePowerNode=function(e,t){switch(!0){case t<33:e.innerHTML="Alta",e.style.color="#0e0";break;case t<66:e.innerHTML="Media",e.style.color="#ee0";break;case t<100||100<=t:e.innerHTML="Baja",e.style.color="#e00"}},this.updateUnitSelector=function(e){var t=e.querySelector("#speed #unitSelected"),n=app.units.getSelUni();utils.opacityTransition(t,n.alias)},this.setTimeReceiver=function(e,t){var n=new Date(t);e.innerHTML="Ultima informaciÃ³n recibida: "+n.toLocaleString()},this.unload=function(e){var t=this;e.domNode.removeEventListener("newdata",function(e){return t.setNodeData(e,node)}),e.domNode.removeEventListener("newspeed",this.updateSpeed)}};am.constructors.main=main;