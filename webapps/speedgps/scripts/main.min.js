"use strict";function Unit(e,a,t){if("string"!=typeof e)throw new TypeError("alias no es una cadena.");isNaN(t)&&(t=0),this.alias=e.toString(),this.description=a,this.fconv=t}window.errStop=function(e){0!=app.bootStatus&&(app.bootStatus=-1,app.wp.setActive(!1),am.events.dispatchAll(new CustomEvent("apperror",{detail:e})))};var debug={name:"Debug",errMsgs:{watchPos:["null","Debes permitir el uso de los servicios de geolocalización para continuar. Habilítalos e intenta nuevamente.","No se ha logrado obtener la ubicación del dispositivo. Intenta nuevamente en un espacio despejado.","Se ha agotado el tiempo de espera para la respuesta. Intenta nuevamente en un espacio despejado.",'Esta aplicación no es compatible con su dispositivo. Para más información consulte en "http://geekzolanos.wordpress.com"'],unidades:['No hay unidades de conversión establecidas en la app. Para más información consulte en "http://geekzolanos.wordpress.com"']},gtBoot:function(){document.body.style.background=app.BACKGROUND_DEFAULT_COLOR,app.gauge.activity.js.setPhaseThree(function(){utils.setTransition(app.gauge.domNode,null),app.gauge.domNode.classList.add("bootSuccess")}),am.startActivity(am.catalog.get("views","main"))},errPos:function(e){errStop(this.errMsgs.watchPos[e.code])}};
"use strict";null!=document.hidden||(document.hidden=document.hidden||document.mozHidden||document.msHidden||document.webkitHidden),window.Notification||(window.Notification=window.Notification||navigator.mozNotification||navigator.webkitNotification);var app={appName:"SpeedGPS",appVer:"2.2.1",appIcon:"/res/logo128.png",isBrowser:!1,rootPath:utils.getRootPath(),bootStatus:2,IS_APP_STARTING:!0,DEFAULT_SLOT_GAUGE_PARAMS:{id:"gauge",size:new Size("15rem"),position:Positions.CENTER,locked:!0},DEFAULT_UNITS:[new Unit("m/s","Metros por segundo",1),new Unit("Km/h","Kilómetros por hora",3.6),new Unit("MPH","Millas por hora",2.24)],DEFAULT_PREFS:[{name:"wp_prefs",enableHighAccuracy:!0,timeout:6e5,maximumAge:12e4},{name:"units",default:2},{name:"data",notify:Modernizr.notification,vibration:{enabled:Modernizr.vibrate,duration:1e3},audio:{enabled:Modernizr.audio,src:"res/chime.mp3"}}],setCompatModules:function(){compat.register("geolocation"),compat.register("indexeddb"),compat.register("promises","promise.min.js"),compat.register("fetch","fetch.js"),compat.register("es6array","es6array.js")}};window.addEventListener("compatpass",function(){app.idb.connect("idb_speedgps").then(function(){app.boot.start()})}),document.addEventListener("deviceready",function(){app.setCompatModules(),compat.evaluate(function(){document.body.innerHTML="Su explorador es incompatible con esta aplicacion. Le recomendamos que actualize su navegador.",document.body.style.color="#ffffff"}),app.isBrowser="browser"==device.platform,"browser"==device.platform&&"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")},!1),window.onerror=function(e,o,i){};
"use strict";app.boot={name:"Boot",start:function(){var t=this;this.startModules().then(function(){app.notify.requestPermission(),am.catalog.populate().then(t.setActivities)})},startModules:function(){return new Promise(function(a,e){app.prefs.startModule().then(function(){var t=[app.units.startModule()];Promise.all(t).then(a,e)})})},setActivities:function(){app.boot,am.createSlots(2),app.gauge=am.slot.create(app.DEFAULT_SLOT_GAUGE_PARAMS),app.gauge.loadActivity(am.catalog.get("gauges","defaultGauge")),setTimeout(function(){utils.setTransition(app.gauge.domNode,"current-far")},1e3),setTimeout(function(){am.startActivity(am.catalog.get("base","boot"))},1300)}};
"use strict";app.data={name:"Data",receive:function(e){if(!e)throw new ReferenceError("data no esta definido.");switch(app.bootStatus){case 2:app.bootStatus=1;break;case 1:!isNaN(e.coords.speed)&&e.coords.accuracy<=100&&(this.playSuccess(),app.bootStatus=0);break;case 0:e.coords.accuracy<=100&&am.events.dispatchAll(new CustomEvent("newdata",{detail:e}))}},playSuccess:function(){var e=app.prefs.get("data");if(document.hidden&&e.notify)app.notify.send({body:"Se ha logrado una conexion exitosa con el sistema GPS.",sound:e.audio.enabled?app.rootPath+e.audio.src:null,vibrate:e.vibration.enabled?e.vibration.duration:null});else{if(e.audio.enabled){var a=document.querySelector("#audioSuccess");a||((a=document.createElement("audio")).id="audioSuccess",a.src=app.rootPath+e.audio.src,document.body.appendChild(a)),a.play()}e.vibration.enabled&&navigator.vibrate&&navigator.vibrate(e.vibration.duration)}},setPrefs:function(e){var n=!1,t=app.prefs.get("data");if(!e)throw new ReferenceError("obj no esta definido.");return e.vibration&&("boolean"==typeof e.vibration.enabled&&e.vibration.enabled!=t.vibration.enabled&&(t.vibration.enabled=e.vibration.enabled,n=!0),"number"==typeof e.vibration.duration&&e.vibration.duration!=t.vibration.duration&&(t.vibration.duration=e.vibration.duration,n=!0)),e.audio&&"boolean"==typeof e.audio.enabled&&e.audio.enabled!=t.audio.enabled&&(t.audio.enabled=e.audio.enabled,n=!0),"boolean"==typeof e.notify&&e.notify!=t.notify&&(t.notify=e.notify,n=!0),new Promise(function(e,a){!0===n?app.prefs.set(t).then(e,a):e()})}},app.events={name:"Events",set:function(){am.events.suscribe(window,"newdata"),am.events.suscribe(window,"unitchanged"),window.addEventListener("newdata",function(e){app.speed.update(e.detail.coords.speed)}),window.addEventListener("unitchanged",function(){app.speed.update()})}},app.idb=new IDBHelper,app.idb.name="IDBHelper",app.idb.createStructure=function(e){var a=[app.prefs.createIDBStruct(e),app.units.createIDBStruct(e)];Promise.all(a).then(function(){})};
"use strict";app.notify={name:"Notifications",requestPermission:function(){app.isBrowser&&"Notification"in window&&Notification.requestPermission()},send:function(i){var e;if(!i)throw new ReferenceError("options no esta definida.");i.icon=navigator.mozApps?"app://gk.speedgps.com"+app.appIcon:app.appIcon,app.isBrowser&&"granted"==Notification.permission&&((e=new Notification(app.appName,i)).addEventListener("click",this.clicked),"show"in e&&e.show())},clicked:function(i){if(!i)throw new ReferenceError("e no esta definida.");"mozApps"in navigator&&(navigator.mozApps.getSelf().onsuccess=function(i){i.target.result.launch()}),i.target&&i.target.close()}};
"use strict";app.prefs={name:"Prefs",catalog:{},startModule:function(){var n=this;return new Promise(function(t){app.idb.getObjects("prefs").then(function(e){e.forEach(function(e){n.catalog[e.name]=e}),t()})})},createIDBStruct:function(e){var r=e.target.result,a=e.target.transaction;return new Promise(function(e){r.createObjectStore("prefs",{keyPath:"name"});for(var t=a.objectStore("prefs"),n=app.DEFAULT_PREFS.length-1;0<=n;n--)t.add(app.DEFAULT_PREFS[n]);e()})},set:function(n){var r=this;if(!n)throw new ReferenceError("Obj no esta definido.");if(!("name"in n))throw new ReferenceError("Obj.name no esta definido.");return new Promise(function(e,t){(r.includes(n.name)?(r.catalog[n.name]=n,app.idb.putObject("prefs",n)):app.idb.addObject("prefs",n)).then(e,t)})},get:function(e){if("string"!=typeof e)throw new TypeError("name no es una cadena.");return this.catalog[e]||!1},includes:function(e){if("string"!=typeof e)throw new TypeError("name no es una cadena.");return!!this.catalog[e]}};
"use strict";app.speed={name:"Speed",lastRawValue:0,update:function(a){"number"==typeof a&&(this.lastRawValue=a);var e=new CustomEvent("newspeed",{detail:this.calculate()});am.events.dispatchAll(e)},calculate:function(){var a=app.units.getSelUni(),e=this.lastRawValue*a.fconv;return{rawValue:this.lastRawValue,finalValue:e.toFixed()}}};
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}app.units={name:"Units",catalog:[],selectedID:null,prepare:function(){var n=this;return this.catalog.forEach(function(t,e){t.constructor!=Unit&&n.catalog.splice(e,1)}),0<this.catalog.length},setNode:function(o,t){var r=t||"option";if(!o)throw new ReferenceError("domNode no esta definido.");if(!("parentNode"in o))throw new TypeError("domNode no es un nodo DOM valido");this.catalog.forEach(function(t,e){var n=document.createElement(r);n.innerHTML=t.description+" ("+t.alias+")",n.value=e,o.appendChild(n)}),o.value=this.selectedID},getSelUni:function(){return this.catalog[this.selectedID]||!1},setSelUni:function(t,e){if(t=parseInt(t),isNaN(t))throw new TypeError("val no es un numero.");this.selectedID!=t&&this.catalog[t]&&(this.selectedID=t,e||am.events.dispatchAll(new Event("unitchanged")))},startModule:function(){var n=this,o=app.prefs.get("units");return new Promise(function(e,t){app.idb.getObjects("units").then(function(t){t.forEach(function(t){n.catalog.push(new Unit(t.alias,t.description,t.fconv))}),n.prepare();try{n.setSelUni(o.default,!0)}catch(t){}e()})})},createIDBStruct:function(t){var o=t.target.result,r=t.target.transaction;return new Promise(function(t){o.createObjectStore("units",{keyPath:"alias"});for(var e=r.objectStore("units"),n=app.DEFAULT_UNITS.length-1;0<=n;n--)e.add(app.DEFAULT_UNITS[n]);t()})},setPrefs:function(t){var n=!1,o=app.prefs.get("units");if(!t)throw new ReferenceError("obj no esta definido.");return"number"==typeof t.default&&t.default!=o.default&&(o.default=t.default,n=!0),new Promise(function(t,e){n?app.prefs.set(o).then(t,e):t()})},remove:function(n){if("number"!=typeof n)throw new TypeError("idx no es un numero.");var o=this,r=this.catalog[n],t=app.prefs.get("units");if(islast=this.catalog.length-1==n,isSelected=this.selectedID==n,isDefault=t.default==n,"object"!=_typeof(r))throw new ReferenceError("El indice no corresponde a ninguna unidad del catalogo.");return Promise(function(t,e){if(this.catalog.length<=1)return e();app.idb.removeObject("units",r.alias).then(function(){o.catalog.splice(n,1),islast&&isSelected&&o.setSelUni(n-1),islast&&isDefault&&o.setPrefs({default:n-1}).then(t),t()},e)})},add:function(o){var r=this;if(o.constructor!=Unit)throw new TypeError("unit no es una Unidad.");return new Promise(function(t,e){var n=r.getID(o.alias);(n?app.idb.putObject:app.idb.addObject)("units",o).then(function(){n?r.catalog[n]=o:r.catalog.push(o),t()},e)})},getID:function(t){if("string"!=typeof t)throw new TypeError("alias no es una cadena.");t=t.toLowerCase();for(var e=0;e<this.catalog.length;e++)if(t==this.catalog[e].alias.toLowerCase())return e;return!1}};
"use strict";app.wp={name:"WatchPosition",idxWatchPos:null,setActive:function(e){var t=app.prefs.get("wp_prefs");if("boolean"!=typeof e)throw new TypeError("value no es booleano.");if(!0===e)this.idxWatchPos=navigator.geolocation.watchPosition(function(e){app.data.receive(e)},function(e){debug.errPos(e)},t);else{if(isNaN(this.idxWatchPos))return;navigator.geolocation.clearWatch(this.idxWatchPos)}},setPrefs:function(e){var o=!1,i=app.prefs.get("wp_prefs");if(!e)throw new ReferenceError("obj no esta definido.");return"boolean"==typeof e.enableHighAccuracy&&e.enableHighAccuracy!=i.enableHighAccuracy&&(i.enableHighAccuracy=e.enableHighAccuracy,o=!0),"number"==typeof e.timeout&&e.timeout!=i.timeout&&(i.timeout=e.timeout,o=!0),"number"==typeof e.maximumAge&&e.maximumAge!=i.maximumAge&&(i.maximumAge=e.maximumAge,o=!0),new Promise(function(e,t){!0===o?app.prefs.set(i).then(e,t):e()})}};