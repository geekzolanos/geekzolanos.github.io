"use strict";var p_units=function(){this.str_newUnit="Nueva Unidad",this.str_editUnit="Editando ",this.load=function(e){this.domNode=e.domNode,this.setEvs(),this.updateUnitList()},this.setEvs=function(){var t=this,e=this.domNode.querySelector("#main"),n=e.querySelector('[role="region"] header > button:first-child'),i=e.querySelector('[role="region"] header menu a'),o=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]'),r=o.querySelector("#btn-default"),a=o.querySelector("#btn-remove"),s=o.querySelector("#btn-edit"),c=o.querySelector("#btn-cancel"),l=this.domNode.querySelector("#new-unit"),d=l.querySelector('[role="region"] header > button:first-child'),u=l.querySelector("form");i.addEventListener("click",function(){t.closeActionMenu(!0),t.openNewUnit("add")}),s.addEventListener("click",function(){t.openNewUnit("edit",parseInt(o.selectedIndex)),t.closeActionMenu(!0)}),n.addEventListener("click",function(){t.close()}),d.addEventListener("click",function(){t.closeNewUnit()}),u.addEventListener("submit",function(e){t.submitUnit(e)}),c.addEventListener("click",function(){t.closeActionMenu()}),r.addEventListener("click",function(){t.setDefaultUnit()}),a.addEventListener("click",function(){t.removeUnit()})},this.updateUnitList=function(){var o=this,r=app.prefs.get("units"),e=app.units.catalog,a=this.domNode.querySelector('#main [role="region"] ul'),s=['<aside class="pack-end default">','<span class="fa fa-check fa-lg"></span>',"</aside>"].join("");a.innerHTML=null,e.forEach(function(e,t){var n=document.createElement("li"),i=['<a href="#">',"<p>"+e.alias+"</p>","<p>"+e.description+"</p>","</a>"];t==r.default&&(i.splice(1,0,s),n.setAttribute("data-default",!0)),n.innerHTML=i.join(""),n.setAttribute("data-id",t),n.addEventListener("click",function(){o.openActionMenu(this)}),a.appendChild(n)})},this.close=function(){am.startActivity(am.catalog.get("preferences","p_main"),{animation:["left-current","current-right"]})},this.openNewUnit=function(e,t){var n,i,o=this.domNode.querySelector("#main"),r=this.domNode.querySelector("#new-unit"),a=r.querySelector('section[role="region"] header h1'),s=r.querySelector("form #alias"),c=r.querySelector("form #desc"),l=r.querySelector("form #fconv");if("string"!=typeof e)throw new TypeError("role no es una cadena.");if("edit"==e){if("number"!=typeof t)throw new TypeError("id no es un numero.");n=app.units.catalog[t],i=parseFloat(n.fconv),a.innerHTML=this.str_editUnit+n.alias,s.value=n.alias,c.value=n.description,l.value=i.toFixed(3),s.disabled=!0}else a.innerHTML=this.str_newUnit,s.disabled=!1;o.classList.remove("current"),r.classList.add("current")},this.closeNewUnit=function(){var e=this.domNode.querySelector("#main"),t=this.domNode.querySelector("#new-unit"),n=t.querySelector("form");t.classList.remove("current"),e.classList.add("current"),n.reset()},this.submitUnit=function(e){var t,n,i,o,r=this,a=e.target;if(!a)throw new ReferenceError("e no es un evento.");if(0!==a.querySelectorAll("input:invalid").length)return!1;t=a.querySelector("#alias").value,n=a.querySelector("#desc").value,i=a.querySelector("#fconv").value,o=new Unit(t,n,i),app.units.add(o).then(function(){r.updateUnitList(),r.closeNewUnit()})},this.openActionMenu=function(e){var t=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]'),n=t.querySelector("header"),i=t.querySelector("#btn-default"),o=t.querySelector("#btn-remove"),r=e.getAttribute("data-id"),a=app.units.catalog[r],s=e.getAttribute("data-default"),c=1==app.units.catalog.length;i.disabled=!!s,o.disabled=!!c,n.innerHTML="Unidad seleccionada: "+a.alias,t.selectedIndex=r,utils.setTransition(t,"bottom-current")},this.closeActionMenu=function(e){var t=e?null:"current-bottom",n=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]');n.selectedIndex=null,utils.setTransition(n,t)},this.setDefaultUnit=function(){var e=this,t=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]'),n={default:parseInt(t.selectedIndex)||0};app.units.setPrefs(n).then(function(){e.updateUnitList(),e.closeActionMenu()})},this.removeUnit=function(){var e=this,t=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]'),n=parseInt(t.selectedIndex)||0;confirm("Â¿Esta seguro que desea eliminar la unidad "+app.units.catalog[n].alias+"?")&&(app.units.remove(n).then(function(){e.updateUnitList()}),e.closeActionMenu())},this.editUnit=function(){var e=this,t=this.domNode.querySelector('#main [role="region"] [role="dialog"][data-type="action"]'),n={default:parseInt(t.selectedIndex)||0};app.units.setPrefs(n).then(function(){e.updateUnitList(),e.closeActionMenu()})}};am.constructors.p_units=p_units;